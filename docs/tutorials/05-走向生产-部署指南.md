# 文章 5 — 走向生产：部署指南

学习目标：面向真实网络拓扑给出部署原则、分阶段上线方法与关键注意事项。

## 5.1 总体策略：分段、分级、可回退

- 分段上线：按接入层→汇聚层→核心层逐步推进，每段先“观察后加固”。
- 策略分级：先启用验证（integrity-only），再开启机密性；先单 SC，逐步细化到按优先级分 SC。
- 明确回退：预置脚本/变更步骤，发生异常可迅速降级到 `validateFrames=check` 或关闭 MACsec，保障业务连续。

## 5.2 接口栈顺序与对端一致性

- 推荐顺序：MAC（PHY） → SecY（MACsec） → VLAN（802.1Q） → 上层（桥/路由）。
- 两端顺序必须一致：保证优先级、标签、长度等处理一致，避免“你加密了我解析标签”的错位。

## 5.3 VLAN-aware 桥接与多实例

- EISS 多实例：按 VLAN 或业务隔离创建多个安全实例（多个 CA），便于分域治理。
- 组播/广播：共享媒体或 EPON 中，建议为 SCB 设置专用 SC，确保全集合帧的可验证性与机密性。

## 5.4 链路聚合（LAG/LACP）

- 每条物理成员链路各自运行 SecY；LACP 在受控端口之上执行。
- 乱序处理：适度放宽重放窗口，或按优先级/业务将流量固定在稳定路径。

## 5.5 Provider Bridged Network 与 EDE

- 红/黑侧边界：在客户侧部署 EDE-M/CS，在运营商侧部署 EDE-SS，透明保护客户与骨干的边界通信。
- 保留地址过滤：确保 EAPOL/PAE 的组播地址仅在正确域内传播，避免跨域窜扰。
- SCI 规划：对大规模网络提前规划 MAC 地址与端口编号，预防冲突与排错困难。

## 5.6 EPON 与点到多点拓扑

- OLT 与多个 ONU：为每个 ONU 提供点到点的受保护服务；SCB 使用专用 SC 并向已授权 ONU 分发其 SAK。
- 广播安全：若 ONU 接收 SCB 帧用于桥/路由，必须进行完整性验证，防止广播面被滥用。

## 5.7 MTU、QoS 与性能

- MTU 提前评估：MACsec 带来额外开销，必要时提升物理 MTU 或在端主机调小 MSS。
- QoS 映射：机密性开启后，外部可能看不到内层 802.1p，确保优先级映射在 SecY 前完成或使用访问优先级表。
- 性能预算：关注设备的 GCM 硬件加速能力与延迟目标，必要时选择更强平台或分级加密策略。

## 5.8 变更与维护窗口

- 重键策略：对高峰低谷的协调，避免批量重键引发瞬时抖动。
- 批量变更：自动化下发策略与密钥；变更前后收集计数器快照，作为验收与回归依据。

## 5.9 典型上线流程模板

1) 资产与链路梳理 → 2) 设备能力盘点 → 3) 试点链路观察模式 → 4) 小范围严格模式 → 5) 全域推广 → 6) 回退演练与应急手册 → 7) 常态化巡检与告警。

完成本篇后，你应能制定一套“可落地”的上线方案。下一篇将围绕密码套件与密钥策略给出选型与调优方法。

